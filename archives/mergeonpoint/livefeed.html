<!DOCTYPE html>
<html>
<head>
  <script type="text/javascript" src="js/jquery-1.11.3.min.js"></script>
  <script type="text/javascript" src="js/jquery-ui.min.js"></script>
  <link rel="stylesheet" href="css/jquery-ui.min.css">
  <link rel="stylesheet" href="css/jquery-ui.structure.min.css">
  <link rel="stylesheet" href="css/jquery-ui.theme.min.css">
  <script type="text/javascript" src="js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <link rel="stylesheet" href="css/bootstrap-theme.min.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0,minimal-ui">
  <style>
  html, body {
    height: 100%;
    width: 100%;
  }

  body, h1, h2, h3, h4, p {
    font-family: "Helvetica Neue", "Segoe UI", Segoe, Helvetica, Arial, "Lucida Grande", sans-serif;
    font-weight: normal;
    margin: 0;
    padding: 0;
    text-align: center;
  }

  p {
    margin-top: 10px;
  }

  td, tr, table {
    text-align: center;
    align-content: center;
  }

  .td:hover {
    background-color: #ddd;
    cursor: pointer;
  }
  </style>
  <script type="text/javascript">
  var form = true;

  function updatePosts() {
    $.ajax({
      url: "feed.txt",
      success: function(data) {
        var posts = document.getElementById("posts");
        posts.innerHTML = "";
        if (data == null || data == undefined || data == "" || isNullOrEmpty(data)) return;
        var feeds = data.split("&");
        var length = feeds.length;
        for (var i = length - 1; i >= 0; i--) {
          var props = feeds[i].split("?");
          var name = "Anonymous";
          if (props[1] == "false") {
            name = props[0];
          }
          if (props[2] == undefined ||isNullOrEmpty(props[2])) continue;
          var message = props[2];
          var element = "<tr><td><div><h3>" + urldecode(name) + "</h3><sub>At " + props[3] + "</sub><p>" + urldecode(message) + "</p></div></td></tr>";
          posts.innerHTML += element;
        }
      }
    });
  }

  function toggleForm() {
    var postsDiv = document.getElementById("postsDiv");
    var div = document.getElementById("formDiv");
    var button = document.getElementById("toggle");
    var commentForm = document.getElementById("commentForm");
    if (form) {
      form = false;
      div.style.height = "26px";
      postsDiv.setAttribute("style", "overflow: auto; height: auto; margin-top: 237px; margin-bottom: 50px;");
      commentForm.setAttribute("style", "visibility: collapse;");
      button.value = "Show";
    } else {
      form = true;
      div.style.height = "262px";
      postsDiv.setAttribute("style", "overflow: auto; height: auto; margin-top: 237px; margin-bottom: 262px;");
      commentForm.setAttribute("style", "visibility: visible;");
      button.value = "Hide";
    }
  }

  function beginLoop() {
    updatePosts();
    window.setInterval(function() {
      updatePosts();
    }, 1500);
}

function isNullOrEmpty(s) {
  if (s == null || s == undefined) return true;
  for (var i = 0; i < s.length; i++) {
    if (s[i] != " ") return false;
  }
  return true;
}

function urldecode(str) {
  var retval = "";
  try {
    $.ajax({
      url: "decode.php?string=" + str,
      success: function(data) {
        retval = data;
      },
      error: function(jqXHR, stringData, errorThrown) {
        ratval = str.replace("+", ' ').replace('%99', '');
      }
    })
    retval = decodeURIComponent((str+'').replace(/\+/g, '%20'));
  }
  catch (err) {
    window.console.log(str);
    window.console.error(err);
    retval = str.replace('%99', '');
  }
  return retval;
}
</script>
</head>
<body onload="beginLoop()" style="height: 100%; width: 100%; background-color: white">
  <div class="navbar navbar-fixed-top" style="background-color: white; border-bottom: 1px solid #ddd; height: auto; width: 100%; margin-bottom: auto;">
    <img style="width: 295px; height: 166px;" src="images/dnow1.png">
    <table class="table" style="margin-bottom: 0px;">
      <tbody>
        <tr>
          <td>
            <a style="width: 180px; cursor: pointer;" href="landing.html"><strong>BACK TO MENU</strong></a>
          </td>
        </tr>
        <tr>
          <td style="padding: 0px; vertical-align: middle;">
            <h2>Share something</h2>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
  <div id="postsDiv" style="overflow: auto; height: auto; width: 100%; margin-top: 237px; margin-bottom: 262px;">
    <table class="table" style="margin-bottom: 0px;">
      <tbody id="posts">
      </tbody>
    </table>
  </div>
  <div class="navbar navbar-fixed-bottom" id="formDiv" style="text-align: center; align-content: center; border-top: 1px solid #ddd; background-color: white; border-bottom: 1px solid #ddd; height: auto; width: 100%;">
    <input type="button" id="toggle" onclick="toggleForm()" value="Hide">
    <form id="commentForm" disabled>
      <label>Name:</label><br>
      <input name="name" type="text" required="true" style="width: 200px;" disabled/><br>
      <label>Keep my name private: </label>
      <input name="private" type="checkbox" disabled/><br>
      <label>Message:</label><br>
      <textarea name="message" required="true" style="width: 300px; height: 100px;" disabled>The livefeed has been locked, but you can still view the previous posts.</textarea><br>
      <input type="submit" value="Post" disabled/>
    </form>
  </div>
</body>
</html>
